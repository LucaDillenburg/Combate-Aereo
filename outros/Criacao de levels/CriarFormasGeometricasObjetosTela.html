<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <script src="../../Javascript/p5/p5.min.js"></script>
    <script src="../../Javascript/Geometria/FormasGeometricas.js"></script>
    <script src="../../Javascript/Geometria/GeometriaBasica.js"></script>
  </head>
  <body>
    NomeImg: <input type="text" id="nomeImg"> <br>
    Forma: <input type="text" id="qualForma">
    Formas(composta): <input type="text" id="formasFormaComposta"> <br>
    Tamanho: <input type="text" id="tamanho"> <br>
    <button id="comecar" onclick="comecar()"> Comecar </button>
    <button id="proporcoes" onclick="printarProporcoes()"> Proporcoes </button>

    <script type="text/javascript" onload="setup()">
      function setup()
      {
        const widthCanvas = window.innerWidth - 20;
        const heightCanvas = window.innerHeight - 110;
        createCanvas(widthCanvas, heightCanvas);
        background(0);
      }

      /*
        "r": retangulo
        "q": quadrado
        "t": triangulo
        "k": quadrilatero
        "p": paralelogramo
        "x": composta
      */

      function nClicks(letraPadrao)
      {
        switch(letraPadrao)
        {
          case "t": return 3;

          case "q":
          case "r":
            return 2;

          default: return 4;
        }
      }

      let pontosForma, img, tamanho, qtdPontosUsados, formasGeometricas, caminhoImg;
      function comecar()
      {
        let numPontos;
        if (document.getElementById("qualForma").value == "x")
        {
          numPontos = 0;
          let formasGeom = document.getElementById("formasFormaComposta").value;
          for (let i = 0; i<formasGeom.length; i++)
            numPontos += nClicks(formasGeom[i]);
        }else
          numPontos = nClicks(document.getElementById("qualForma").value);

        pontosForma = new Array(numPontos);
        qtdPontosUsados = 0;

        caminhoImg = "Imagens/" + document.getElementById("nomeImg").value;
        img = loadImage("../../"+caminhoImg);
        console.log(caminhoImg);
        tamanho = document.getElementById("tamanho").value;
        formasGeometricas = undefined;

        document.getElementById("defaultCanvas0").onclick = click;
      }

      function click()
      {
        pontosForma[qtdPontosUsados] = new Ponto(mouseX, mouseY);
        qtdPontosUsados++;

        console.log(qtdPontosUsados + " e " + pontosForma.length)
        if (qtdPontosUsados === pontosForma.length)
        {
          console.log("todos os pontos");

          // cria formasGeometricas
          formasGeometricas = [];
          if (document.getElementById("qualForma").value == "x")
          {
            let formasGeom = document.getElementById("formasFormaComposta").value;
            let numPontos = 0;
            for (let i = 0; i<formasGeom.length; i++)
            {
              formasGeometricas[i] = criarFormaGeometrica(numPontos, formasGeom[i]);
              numPontos += nClicks(formasGeom[i]);
            }
          }else
            formasGeometricas[0] = criarFormaGeometrica(0, document.getElementById("qualForma").value);
        }
      }
      function criarFormaGeometrica(nClicks, letraForma)
      {
        switch (letraForma)
        {
          case "r":
            return new Retangulo(pontosForma[nClicks].x, pontosForma[nClicks].y,
              pontosForma[nClicks+1].x - pontosForma[nClicks].x,
              pontosForma[nClicks+1].y - pontosForma[nClicks].y, {fill: "green"});
          case "t":
            return new Triangulo(pontosForma[nClicks], pontosForma[nClicks+1],
              pontosForma[nClicks+2], {fill: "green"});
          case "k":
            return new Quadrilatero(pontosForma[nClicks], pontosForma[nClicks+1],
              pontosForma[nClicks+2], pontosForma[nClicks+3], {fill: "green"});
          case "p":
            return new Paralelogramo(pontosForma[nClicks], pontosForma[nClicks+1],
              pontosForma[nClicks+2], pontosForma[nClicks+3], {fill: "green"});
        }
      }

      function printarProporcoes()
      {
        if (formasGeometricas.length > 1)
        {
          const constante = maiorWidth(); // TAMANHO BASEADO NO MAIOR WIDTH SENDO 1

          let menorX, menorY;
          formasGeometricas.forEach(forma => {
            if (menorX == undefined || forma.menorX < menorX)
              menorX = forma.menorX;
            if (menorY == undefined || forma.menorY < menorY)
              menorY = forma.menorY;
          });

          let str = "const tamanho = " + document.getElementById("tamanho").value + ";\n";
          str += "const formaGeometrica = new FormaGeometricaComposta(undefined,undefined, \n"
            + "[\n";
          formasGeometricas.forEach(forma => {
            if (forma instanceof Retangulo)
              str += "  new Retangulo("+ ((forma.menorX - menorX)/constante) +"*tamanho,"+ ((forma.menorY - menorY)/constante) +"*tamanho, "+(forma.width/constante)+"*tamanho, "+(forma.height/constante)+"*tamanho),";
            else
            {
              let p = new Ponto(menorX, menorY);

              let a = forma._a.menos(p).dividido(constante);
              let b = forma._b.menos(p).dividido(constante);
              let c = forma._c.menos(p).dividido(constante);

              let funct = function(p) { return "new Ponto("+p.x+", "+p.y+")"; }

              if (forma instanceof Triangulo)
                str += "  new Triangulo("+funct(a)+".multiplicado(tamanho), "+funct(b)+".multiplicado(tamanho), "+funct(c)+".multiplicado(tamanho)),";
              else
              {
                let d = forma._d.menos(p).dividido(constante);

                if (forma instanceof Quadrilatero)
                  str += "  new Quadrilatero("+funct(a)+".multiplicado(tamanho), "+funct(b)+".multiplicado(tamanho), "+funct(c)+".multiplicado(tamanho), "
                    +funct(d)+".multiplicado(tamanho)),";
                else
                if (forma instanceof Paralelogramo)
                  str += "  new Paralelogramo("+funct(a)+".multiplicado(tamanho), "+funct(b)+".multiplicado(tamanho), "+funct(c)+".multiplicado(tamanho), "
                    +funct(d)+".multiplicado(tamanho)),";
              }
            }
            str += "\n";
          });
          str += "], \n\""+caminhoImg+"\")";

          console.log(str);
        }else
        {
          /*
            Regra de 3:
            width -- height
                1 -- x
            x = height/width

            constante = width;
          */

          const x = formasGeometricas[0].height / formasGeometricas[0].width;
          const constante = formasGeometricas[0].width;

          console.log(
            "const tamanho = " + document.getElementById("tamanho").value + ";\n" +
            "const formaGeometrica = new Retangulo(undefined,undefined, 1*tamanho, "+x+"*tamanho, corImg);\n"
          );
        }
      }
      function maiorWidth()
      {
        let maiorWidth = 0;
        formasGeometricas.forEach(forma => {
          if (forma.width > maiorWidth)
            maiorWidth = forma.width;
        });
        return maiorWidth;
      }

      function draw()
      {
        //imagem grande
        if (img !== undefined)
        {
          const tam = 400;
          image(img, 20, 20, tam, tam*img.height/img.width);

          //da pra mudar o tamanho que a imagem vai ser printada mudando img.width e img.height (mudar mas manter as proporcoes)
        }

        //imagem do tamanho desejado
        if (img !== undefined)
          image(img, 600, 250, tamanho, tamanho*img.height/img.width);

        //formasGeometricas
        if (formasGeometricas !== undefined)
        {
          //desenhar formasGeometricas
          formasGeometricas.forEach(forma => {
            forma.draw();
          });
        }
      }
    </script>
  </body>
</html>
